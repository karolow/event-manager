{% extends '_base.html' %}
{% load materializecss %}

{% block title %}Event{% endblock title %}
{% block content %}
<div class="row">
  <div class="col l8 s12 offset-l2">
    <h2>Event</h2>
    <form method="post">
      {% csrf_token %}
      {{ form.title|materializecss }}
      <div class="row">
        <div class="col s12 m6">
          {{ form.project|materializecss }}
        </div>
        <div class="col s12 m6">
          {{ form.type|materializecss }}
        </div>
      </div>
      {{ form.description|materializecss:'icon=text_fields' }}
      <div class="row">
        <div class="col s12 m6">
          {{ form.location|materializecss }}
        </div>
        <div class="col s12 m6">
          {{ form.room|materializecss }}
        </div>
      </div>
      <div class="row">
        <div class="input-field col s12 m6">
          <div id="{{ form.start_at.name }}">
            <div class="input-field col s12">
              <i class="material-icons prefix">schedule</i>
              <input type="text" id="id_{{ form.start_at.name }}" name="{{ form.start_at.name }}" value="{{ form.start_at.value|date:'Y-m-d H:i' }}" class=" validate">
              <label for="id_{{ form.start_at.name }}">{{ form.start_at.label }}</label>
            </div>
          </div>
        </div>
        <div class="input-field col s12 m6">
          <div id="{{ form.end_at.name }}">
            <div class="input-field col s12">
              <i class="material-icons prefix">schedule</i>
              <input type="text" id="id_{{ form.end_at.name }}" name="{{ form.end_at.name }}" value="{{ form.end_at.value|date:'Y-m-d H:i' }}" class=" validate">
              <label for="id_{{ form.end_at.name }}">{{ form.end_at.label }}</label>
            </div>
          </div>
        </div>
      </div>
      {{ form.timetable|materializecss }}
      <div class="row">
        <div class="col s12 m4">
          {{ form.fields|materializecss }}
        </div>
        <div class="col s12 m4">
          {{ form.audiences|materializecss }}
        </div>
        <div class="col s12 m4">
          {{ form.online|materializecss }}
          {{ form.tickets|materializecss }}
        </div>
      </div>
      <div class="row">
        <div class="col s12 m6">
          {{ form.ownership|materializecss }}
        </div>
        <div class="col s12 m6">
          {{ form.partners|materializecss }}
        </div>
      </div>
      <div class="row">
        <div class="col s12 m6">
          {{ form.fees|materializecss:'icon=money' }}
        </div>
        <div class="col s12 m6">
          {{ form.budget|materializecss }}
        </div>
      </div>
      <div class="row">
        <div class="col s12 m6">
          {{ form.particip_num_predict|materializecss }}
        </div>
        <div class="col s12 m6">
          {{ form.particip_num_actual|materializecss }}
        </div>
      </div>
      <div class="row">
        <div class="col s12 m6">
          {{ form.link|materializecss:'icon=link' }}
        </div>
        <div class="col s12 m6">
          {{ form.registr_link|materializecss }}
        </div>
      </div>
      {{ form.comment|materializecss }}
      <div class="row">
        <div class="col s12 m6">
          {{ form.status|materializecss:'icon=assignment' }}
        </div>
        <div class="col s12 m6">
          {{ form.contact_person|materializecss:'icon=face' }}
        </div>
      </div>
      <button class="btn waves-effect waves-light" type="submit">Save<i class="material-icons right">send</i></button>
    </form>
  </div>
</div>

<script>
    jQuery(document).ready(function(){

        // Initialize materialize data picker
        var dummyTime = null;
        var currentDateElem = null;
        var dateObj = new Date();

        jQuery('#id_start_at,#id_end_at').datepicker({
            format: 'yyyy-mm-dd',
            onClose: function () {
                currentDateElem = this.el;
                if(currentDateElem.value !== '') {
                    $('body').append('<input type="hidden" id="dummyTime">')
                    dummyTime = $("#dummyTime");
                    dummyTime.timepicker({
                        twelveHour: false,
                        onCloseEnd: function () {
                            var time = dummyTime.val();
                            if (time === '') {
                                time = dateObj.getHours() + ':' + (dateObj.getMinutes() < 10 ? '0' + dateObj.getMinutes() : dateObj.getMinutes() );
                            }
                            currentDateElem.value = currentDateElem.value.replace(/\s\d{2}:\d{2}/, '') + ' ' + time;
                            currentDateElem = null;
                            dummyTime.remove()
                        }
                    });
                    dummyTime.trigger('click');
                }
            }
        });

    });
</script>
{% endblock content %}
